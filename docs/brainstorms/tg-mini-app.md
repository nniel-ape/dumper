# Telegram Mini App for Dumper

## Overview

A Telegram Mini App for Dumper that lets users browse, search, and explore their personal knowledge vault directly within Telegram. The app provides three main experiences:

1. **Items Feed** - A scrollable list of saved items with titles, summaries, and tags
2. **Unified Search/Q&A** - A single search bar that handles both keyword search and natural language questions, returning relevant items plus AI-generated answers when appropriate
3. **Knowledge Graph** - An interactive React Flow visualization showing relationships between saved items

The app uses Telegram's native theming (dark/light mode follows user's TG settings), integrates with the existing Go backend via the `/api/*` endpoints, and authenticates using Telegram's init data mechanism.

## Goals

- **Fast and native-feeling** - Sub-second load times, smooth 60fps scrolling, gestures that match Telegram's UX patterns
- **Mobile-first** - Designed for phone screens (90%+ of TG Mini App usage), touch-optimized interactions
- **Unified search experience** - Users don't need to decide between "search" and "ask" - the system intelligently handles both
- **Visual knowledge exploration** - The graph view helps users discover connections they didn't know existed
- **Zero friction auth** - Leverages Telegram's init data, no login screens or additional setup
- **Telegram theme integration** - Automatically adapts to user's light/dark mode and accent colors via CSS variables

## Non-Goals

- **Content ingestion** - Users add content via the Telegram bot (forwarding links/text), not through the Mini App
- **Offline support** - App requires network connectivity; no service workers or local database sync
- **Desktop optimization** - While it will work on desktop TG, we won't optimize for large screens
- **Manual relationship editing** - Relationships are auto-generated by the backend LLM; users can't manually link items
- **Export functionality in-app** - Export to Obsidian happens via bot command or direct API call, not through Mini App UI
- **Multi-language i18n** - English only for MVP; internationalization can be added later
- **Push notifications** - Mini Apps don't support push; users get bot messages for new content

## User Experience

**App Launch**: User taps the Mini App button in the bot chat. App loads instantly with a skeleton UI, then populates with their items.

**Bottom Navigation** (4 tabs):
- **Items** - Chronological feed of saved content, pull-to-refresh, infinite scroll. Tapping an item opens a detail sheet with full summary, tags, and original URL
- **Search** - Search bar at top, results appear as user types (debounced). For question-like queries ("what did I save about..."), shows AI answer card above results with cited sources
- **Graph** - Interactive React Flow canvas. Nodes are items (sized by connection count), edges show relationships. Pinch to zoom, tap node to see item preview, double-tap to open detail
- **Settings** - Stats (item count, tag count), export button (triggers download), theme preview, about/version

**Item Detail Sheet**: Slides up from bottom (60% height, draggable to full). Shows: title, summary, tags (tappable to filter), timestamps, "Open Original" button that uses `Telegram.WebApp.openLink()`.

**Search Intelligence**: The search bar detects question patterns (starts with "what", "how", "why", contains "?") and automatically triggers the `/api/ask` endpoint alongside regular search, displaying both the AI answer and matching items.

## Technical Approach

**Stack**:
- React 18 + Vite (fast HMR, optimized builds)
- TypeScript (strict mode)
- Tailwind CSS + shadcn/ui for components (Button, Sheet, Input, Tabs, etc.)
- Telegram CSS variables mapped to shadcn's design tokens
- React Flow for graph visualization
- TanStack Query (React Query) for data fetching/caching
- `@telegram-apps/sdk-react` for Telegram WebApp API integration

**Project Structure** (`web/`):
```
web/
├── index.html
├── vite.config.ts
├── tailwind.config.ts
├── components.json        # shadcn config
├── src/
│   ├── main.tsx
│   ├── App.tsx
│   ├── api/               # API client, types
│   ├── components/
│   │   └── ui/            # shadcn components
│   ├── pages/             # Items, Search, Graph, Settings
│   ├── hooks/             # Custom hooks
│   └── lib/
│       └── utils.ts       # cn() helper for shadcn
└── dist/
```

**API Integration**: Single API client using `fetch`, automatically injects `X-Telegram-Init-Data` header from `Telegram.WebApp.initData`. TanStack Query handles caching, refetching, and loading states.

**Theming Strategy**: Override shadcn's CSS variables with Telegram's theme values. The `Sheet` component becomes our item detail drawer, `Input` for search, `Tabs` for bottom navigation styling.

**Build & Deploy**: `npm run build` outputs to `web/dist/`, served by Go backend at `/`.

## Key Components

**Core Layout**:
- `App.tsx` - Initializes Telegram SDK, sets up React Query provider, renders tab router
- `BottomNav.tsx` - Fixed bottom bar with 4 tabs (Items, Search, Graph, Settings), highlights active tab

**Items Tab**:
- `ItemsFeed.tsx` - Infinite scroll list using TanStack Query's `useInfiniteQuery`, pull-to-refresh via touch events
- `ItemCard.tsx` - Compact card showing title, truncated summary, tag pills, timestamp
- `ItemSheet.tsx` - shadcn `Sheet` component for full item details, slides up from bottom

**Search Tab**:
- `SearchPage.tsx` - Manages search state, debounces input, detects question patterns
- `SearchInput.tsx` - shadcn `Input` with search icon, clear button
- `AIAnswerCard.tsx` - Displays AI-generated answer with expandable source citations
- `SearchResults.tsx` - Reuses `ItemCard` for result list

**Graph Tab**:
- `GraphView.tsx` - React Flow canvas with custom node/edge types
- `ItemNode.tsx` - Custom node renderer showing item title, colored by primary tag
- `NodePreview.tsx` - Tooltip/popover on node tap with summary + "View Details" button

**Settings Tab**:
- `SettingsPage.tsx` - Stats display, export trigger, app info

**Shared**:
- `TagPill.tsx` - Colored tag badge, tappable to filter
- `LoadingSkeleton.tsx` - Animated placeholders matching card layouts
- `EmptyState.tsx` - Friendly messages when no items/results

## Open Questions

- **Graph layout algorithm** - Should nodes auto-arrange (force-directed) or allow manual positioning? Force-directed is simpler but can be chaotic with many nodes
- **Search debounce timing** - 300ms is typical, but should question detection (triggering AI) have a longer delay (500ms) to avoid unnecessary API calls?
- **Item card content** - Show full summary truncated, or just title + tags? More content = more scrolling on mobile
- **Graph node limit** - React Flow handles ~500 nodes smoothly. Should we paginate/filter the graph for users with 1000+ items, or lazy-load nodes on zoom?
- **Haptic feedback** - Telegram SDK supports haptics. Which interactions should trigger them? (tab switch, item open, pull-to-refresh complete)
- **Error handling UX** - Toast notifications (shadcn `Sonner`) vs inline error states? Toasts are less intrusive but easier to miss
- **Tag colors** - Generate deterministically from tag name (hash to HSL), or predefined palette?

---
*Generated via /brainstorm on 2026-01-16*
